<!-- ################################################################################
# 文件: robot_startUp.launch
# 位置: /home/nav01/zj_humanoid/startup/robot_startUp.launch
# 说明: 机器人主启动 launch 文件
# 功能: 启动所有必要的机器人节点和接口
################################################################################ -->
<launch>
    <!-- ================= 参数定义 ================= -->
    <arg name="robot_name" default="zj_humanoid" 
         doc="机器人命名空间，用于区分不同机器人实例"/>
    <arg name="robot_type" default="$(optenv ROBOT_TYPE WA1)" 
         doc="机器人型号 (WA1, WA2, H1, I2, I180)，优先从环境变量读取"/>
    <arg name="config_file" default="/home/nav01/zj_humanoid/config/naviai_default.yaml"
         doc="全局配置文件路径"/>
    <arg name="gdb_prefix" default="gdb -ex run --args"
         doc="启用调试时使用的 gdb 前缀命令"/>
    <arg name="hand_enable_gdb" default="false"
         doc="是否通过 gdb 启动灵巧手硬件接口节点"/>
    <arg name="naviai_wa_enable_gdb" default="false"
         doc="是否通过 gdb 启动 WA/H 系列主控节点"/>
    <arg name="naviai_i180_enable_gdb" default="false"
         doc="是否通过 gdb 启动 I180 主控节点"/>
    <arg name="naviai_i2_enable_gdb" default="false"
         doc="是否通过 gdb 启动 I2 主控节点"/>

          <!-- ================= 加载全局配置 ================= -->
          <group ns="$(arg robot_name)">
                    <rosparam command="load" file="$(arg config_file)"/>
                    <param name="robot_type" value="$(arg robot_type)" />
                    <!-- ================= 灵巧手硬件接口节点 ================= -->
                    <node name="hand" 
                                   pkg="dexhand_interface" 
                                   type="dexhand_interface_node" 
                                   output="screen" 
                                   respawn="false" 
                                   respawn_delay="0"
                                   launch-prefix="$(eval arg('gdb_prefix') if arg('hand_enable_gdb') == 'true' else '')">
                              <!-- 可以在这里添加灵巧手特定的参数 -->
                    </node>
          </group>

    <!-- ================= 启动灵巧手硬件接口 ================= -->

    <!-- <include file="$(find dexhand_interface)/launch/dexhand_hw_interface.launch">
        <arg name="robot_name" value="$(arg robot_name)" />
    </include> -->

    <!-- ================= WA/H 系列主控节点 ================= -->
    <node if="$(eval arg('robot_type') != 'I2' and arg('robot_type') != 'I180')" 
          name="$(arg robot_name)_naviai_robot"
          pkg="naviai_robot" 
          type="naviai_wa_h_robot_node" 
          output="screen" 
          respawn="false" 
          respawn_delay="0"
          ns="$(arg robot_name)"
          launch-prefix="$(eval arg('gdb_prefix') if arg('naviai_wa_enable_gdb') == 'true' else '')">
        <param name="robot_type" value="$(arg robot_type)" />
    </node>

    <!-- ================= I180 专用主控节点 ================= -->
    <node if="$(eval arg('robot_type') == 'I180')"
          name="$(arg robot_name)_naviai_robot"
          pkg="naviai_robot"
          type="naviai_i180_robot_node"
          output="screen"
          respawn="false"
          respawn_delay="0"
          ns="$(arg robot_name)"
          launch-prefix="$(eval arg('gdb_prefix') if arg('naviai_i180_enable_gdb') == 'true' else '')">
        <param name="robot_type" value="$(arg robot_type)" />
    </node>

    <!-- ================= I2 专用主控节点 ================= -->
    <node if="$(eval arg('robot_type') == 'I2')" 
          name="$(arg robot_name)_naviai_robot"
          pkg="naviai_robot" 
          type="naviai_i_robot_node" 
          output="screen" 
          respawn="false" 
          respawn_delay="0"
          ns="$(arg robot_name)"
          launch-prefix="$(eval arg('gdb_prefix') if arg('naviai_i2_enable_gdb') == 'true' else '')">
        <param name="robot_type" value="$(arg robot_type)" />
    </node>

    <!-- ================= I2 专用配置 ================= -->
    <group if="$(eval arg('robot_type') == 'I2')">
        <!-- 加载 URDF 模型 -->
        <param name="legged_robot_description" 
               textfile="$(find legged_nav_description)/urdf/hi2/hi2.urdf"/>
        
        <!-- 加载配置 -->
        <rosparam file="$(find legged_nav2_hw)/config/nav.yaml" 
                  command="load" 
                  ns="$(arg robot_name)"/>
        
        <!-- 启动运动控制器 -->
        <include file="$(find legged_rl_controllers)/launch/one_start_real.launch">
            <arg name="robot_name" value="$(arg robot_name)" />
        </include>
    </group>
    
    <!-- ================= 手柄控制模块 ================= -->
    <!-- <include file="$(find joy_manager)/launch/joy_manager.launch">
        <arg name="robot_name" value="$(arg robot_name)" />
    </include> -->
    
</launch>